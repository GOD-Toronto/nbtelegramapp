name: "Build and Deploy"
on:
  workflow_dispatch:
  push:
    branches:
      - github_actions

env: 
  AWS_REGION: ca-central-1
  S3BUCKET: nama-bhiksha
  applicationfolder: nbtelegramapp

jobs: 
  build: 
    name: "Build and Package"
    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@v1
      - name: "Configure AWS credentials"
        uses: aws-actions/configure-aws-credentials@v1
        with: 
          aws-access-key-id: "${{ secrets.AWS_ACCESS_KEY_ID }}"
          aws-region: "${{ env.AWS_REGION }}"
          aws-secret-access-key: "${{ secrets.AWS_SECRET_ACCESS_KEY }}"
      
      - name: "Set up JDK 17"
        uses: actions/setup-java@v2
        with: 
          cache: gradle
          distribution: adopt
          java-version: 17

      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2    
      
      - name: Make gradlew executable
        run: chmod +x ./gradlew
      
      - name: "Execute with Gradle"
        run: "./gradlew build --scan --no-daemon"
      



      # - name: "Upload Artifact to s3"
      #   run: "aws s3 cp *.jar s3://${{ env.S3BUCKET }}/"
      #   working-directory: "${{ env.applicationfolder }}/target"